<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
        <title>EduQube Dashboard</title>
        <link href="css/chartstyles.css" rel="stylesheet" />
        <meta charset="UTF-8">
        <script src="http://s.codepen.io/assets/libs/modernizr.js" type="text/javascript"></script>
    
        <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script> 
        

        <script type="text/javascript" src="/moment.min.js"></script>
        <script type="text/javascript" src="/Chart.js"></script>
        <script type="text/javascript" src="/chartjs-plugin-streaming.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
        </script>
        <script type = "text/javascript" language = "javascript">
         var mqtt;
         var reconnectTimeout = 2000;
         var host="35.247.242.221";
         var port=8083;
         var gyro_x = "0";
         var gyro_y = "0";
         var gyro_z = "0";
         var accel_x = "0";
         var accel_y = "0";
         var accel_z = "0";
         var mag_x = "0";
         var mag_y = "0";
         var mag_z = "0";
         var humidity = "0";
         var pressure = "0";
         var temperature = "0";
         var altitude = "0";
         var gps_lat = "-38";
         var gps_long = "-57";
         var rssi = "0";
         let launchdate;
     
         function onFailure(message) {
           console.log("Connection Attempt to Host "+host+"Failed");
           setTimeout(MQTTconnect, reconnectTimeout);
             }
     
         function onMessageArrived(msg){
           out_msg="Message received "+msg.payloadString+"<br>";
           out_msg=out_msg+"Message received Topic "+msg.destinationName;
           console.log(out_msg);
           if(msg.destinationName == "gyro_x")
           {
            gyro_x = msg.payloadString;
           }
           else if(msg.destinationName == "gyro_y")
           {
            gyro_y = msg.payloadString;
           }
           else if(msg.destinationName == "gyro_z")
           {
            gyro_z = msg.payloadString;
           }
           else if(msg.destinationName == "accel_x")
           {
            accel_x = msg.payloadString;
           }
           else if(msg.destinationName == "accel_y")
           {
            accel_y = msg.payloadString;
           }
           else if(msg.destinationName == "accel_z")
           {
            accel_z = msg.payloadString;
           }
           else if(msg.destinationName == "mag_x")
           {
            mag_x = msg.payloadString;
           }
           else if(msg.destinationName == "mag_y")
           {
            mag_y = msg.payloadString;
           }
           else if(msg.destinationName == "mag_z")
           {
            mag_z = msg.payloadString;
           }
           else if(msg.destinationName == "humidity")
           {
            humidity = msg.payloadString;
           }
           else if(msg.destinationName == "temperature")
           {
            temperature = msg.payloadString;
           }
           else if(msg.destinationName == "pressure")
           {
            pressure = msg.payloadString;
           }
           else if(msg.destinationName == "altitude")
           {
            altitude = msg.payloadString;
           }
           else if(msg.destinationName == "mag_x")
           {
            mag_x = msg.payloadString;
           }
           else if(msg.destinationName == "gps_lat")
           {
            gps_lat = msg.payloadString;
           }
           else if(msg.destinationName == "gps_long")
           {
            gps_long = msg.payloadString;
           }
           else if(msg.destinationName == "rssi")
           {
            rssi = msg.payloadString;
           }
           else if(msg.destinationName == "launchdate")
           {
            launchdate = msg.payloadString;
           }
         }
     
          function onConnect() {
            // Once a connection has been made, make a subscription
            console.log("Connected ");
            mqtt.subscribe("gyro_x");
            mqtt.subscribe("gyro_y");
            mqtt.subscribe("gyro_z");
            mqtt.subscribe("accel_x");
            mqtt.subscribe("accel_y");
            mqtt.subscribe("accel_z");
            mqtt.subscribe("mag_x");
            mqtt.subscribe("mag_y");
            mqtt.subscribe("mag_z");
            mqtt.subscribe("humidity");
            mqtt.subscribe("pressure");
            mqtt.subscribe("temperature");
            mqtt.subscribe("altitude");
            mqtt.subscribe("gps_lat");
            mqtt.subscribe("gps_long");
            mqtt.subscribe("rssi");
            mqtt.subscribe("launchdate");
          }

         function MQTTconnect() {
         console.log("connecting to "+ host +" "+ port);
         mqtt = new Paho.MQTT.Client(host,port,"clientjs");

         var options = {
           timeout: 3,
           onSuccess: onConnect,
           onFailure: onFailure,
            };
         mqtt.onMessageArrived = onMessageArrived
         
         mqtt.connect(options);
         }
        </script>

        <script>
          MQTTconnect();
        </script>


    </head>

    <body class="sb-nav-fixed">
        <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
            <img id="logo-navbar" src="https://cloud-object-storage-th-cos-standard-5mr.s3.us-south.cloud-object-storage.appdomain.cloud/innova%20space%202-blanco.png" height="30px">
            <a class="navbar-brand" href="index.html">EduQube Dashboard</a>
        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid">
                        <h1 class="mt-4"></h1>

                        <div class="row">
                            <!--Signal Quality Chart-->
                            <div class="col-xl-12">
                                <div class="card mb-3">
                                        <div class="card-header">
                                            RSSI
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                        label: 'RSSI (dBm)',
                                                        borderColor: 'rgb(255, 0, 0)',
                                                        backgroundColor: 'rgba(255, 0, 0, 0.5)',
                                                        }  
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                            delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: rssi                                        
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            </div>
                        </div>
                        
                         <div class="row">    
                           <!--Temperature Chart-->
                           <div class="col-xl-12">
                                <div class="card mb-4">
                                        <div class="card-header">
                                             Temperature
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart2" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart2').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                        label: 'Temperature (ºC)',
                                                        borderColor: 'rgb(255, 0, 0)',
                                                        backgroundColor: 'rgba(255, 0, 0, 0.5)',
                                                        }  
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                           delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: temperature                                        
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            </div> 
                        </div>
                                       
                        <!--Humidity Chart-->
                        <div class="col-xl-12">
                            <div class="card mb-4">
                                    <div class="card-header">
                                         Humidity
                                    </div>
                                    <div class="card-bodys"><canvas id="myChart4" height="45px" style="color: white;"></canvas></div>
                                    <script>
                                        
                                        var ctx = document.getElementById('myChart4').getContext('2d');
                                            var chart = new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                               
                                                datasets: [{
                                                    label: 'Humidity (%)',
                                                    borderColor: 'rgb(255, 0, 0)',
                                                    backgroundColor: 'rgba(255, 0, 0, 0.5)',
                                                    }, 
                                                ]

                                            },
                                            
                                            options: {
                                                scales: {
                                                xAxes: [{
                                                    type: 'realtime',
                                                    realtime: {
                                                        duration: 60000,
                                                        refresh: 5000,
                                                       delay: 5000,

                                                        onRefresh: function(chart) { 
                                                        chart.data.datasets.forEach(function(dataset) {
                                                        dataset.data.push({
                                                            
                                                            x: Date.now(),
                                                            y: humidity                                        
                                                        });
                                                        });
                                                        
                                                    }      
                                                    }

                                                }]
                                                }
                                                
                                            }
                                            });
                                    </script>
                            </div>
                        </div>
                        
                        <div class="row">
                            <!--Pressure Chart-->
                            <div class="col-xl-12">
                                <div class="card mb-4">
                                        <div class="card-header">
                                             Pressure
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart3" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart3').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                        label: 'Pressure (hPa)',
                                                        borderColor: 'rgb(255, 0, 0)',
                                                        backgroundColor: 'rgba(255, 0, 0, 0.5)',
                                                        } 
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                           delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: pressure                                        
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            </div>
                        
                            <!--Altitude Chart-->
                            <div class="col-xl-12">
                                <div class="card mb-4">
                                        <div class="card-header">
                                             Altitude
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart7" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart7').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                        label: 'Altitude (m)',
                                                        borderColor: 'rgb(255, 0, 0)',
                                                        backgroundColor: 'rgba(255, 0, 0, 0.5)',
                                                        }, 
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                           delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: altitude                                        
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            </div>
                            
                            <!--Power consumption Chart-->
                            <div class="col-xl-12">
                                <div class="card mb-4">
                                        <div class="card-header">
                                             Power consumption 
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart6" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart6').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                            label: 'Battery voltage',
                                                            borderColor: 'rgb(255, 0, 0)',
                                                            backgroundColor: 'rgba(255, 0, 0, 0.5)',

                                                        }, {
                                                            label: 'Bus power consumption',
                                                            borderColor: 'rgb(0, 0, 255)',
                                                            backgroundColor: 'rgba(0, 0, 255, 0.5)', 
                                                        },
                                                        {
                                                            label: 'Current Intensity',
                                                            borderColor: 'rgb(0, 255, 0)',
                                                            backgroundColor: 'rgba(0, 255, 0, 0.5)', 
                                                        }
                                                        
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                           delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: humidity                                        
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            
                            </div>
                            <!--Gyroscope Chart-->
                            <div class="col-xl-12">
                                <div class="card mb-4">
                                        <div class="card-header">
                                             Gyroscope
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart5" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart5').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                            label: 'X Axis',
                                                            borderColor: 'rgb(255, 99, 132)',
                                                            backgroundColor: 'rgba(255, 99, 132, 0.5)',

                                                        }, {
                                                            label: 'Y Axis',
                                                            borderColor: 'rgb(54, 162, 235)',
                                                            backgroundColor: 'rgba(54, 162, 235, 0.5)', 
                                                        },
                                                        {
                                                            label: 'Z Axis',
                                                            borderColor: 'rgb(0, 255, 0)',
                                                            backgroundColor: 'rgba(0, 255, 0, 0.5)', 
                                                        }
                                                        
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                            delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: gyro_x                                        
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            </div>
                            
                            <!--Accelerometer Chart-->
                            <div class="col-xl-12">
                                <div class="card mb-4">
                                        <div class="card-header">
                                             Accelerometer
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart8" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart8').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                            label: 'X Axis',
                                                            borderColor: 'rgb(255, 99, 132)',
                                                            backgroundColor: 'rgba(255, 99, 132, 0.5)',

                                                        }, {
                                                            label: 'Y Axis',
                                                            borderColor: 'rgb(54, 162, 235)',
                                                            backgroundColor: 'rgba(54, 162, 235, 0.5)', 
                                                        },
                                                        {
                                                            label: 'Z Axis',
                                                            borderColor: 'rgb(0, 255, 0)',
                                                            backgroundColor: 'rgba(0, 255, 0, 0.5)', 
                                                        }
                                                        
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                            delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: accel_x                                        
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            </div>


                            <!--Gyroscope Chart-->
                            <div class="col-xl-12">
                                <div class="card mb-4">
                                        <div class="card-header">
                                             Gyroscope
                                        </div>
                                        <div class="card-bodys"><canvas id="myChart9" height="45px" style="color: white;"></canvas></div>
                                        <script>
                                            
                                            var ctx = document.getElementById('myChart9').getContext('2d');
                                                var chart = new Chart(ctx, {
                                                type: 'line',
                                                data: {
                                                   
                                                    datasets: [{
                                                            label: 'X Axis',
                                                            borderColor: 'rgb(255, 99, 132)',
                                                            backgroundColor: 'rgba(255, 99, 132, 0.5)',

                                                        }, {
                                                            label: 'Y Axis',
                                                            borderColor: 'rgb(54, 162, 235)',
                                                            backgroundColor: 'rgba(54, 162, 235, 0.5)', 
                                                        },
                                                        {
                                                            label: 'Z Axis',
                                                            borderColor: 'rgb(0, 255, 0)',
                                                            backgroundColor: 'rgba(0, 255, 0, 0.5)', 
                                                        }
                                                        
                                                    ]

                                                },
                                                
                                                options: {
                                                    scales: {
                                                    xAxes: [{
                                                        type: 'realtime',
                                                        realtime: {
                                                            duration: 60000,
							                                refresh: 5000,
                                                            delay: 5000,

                                                            onRefresh: function(chart) { 
                                                            chart.data.datasets.forEach(function(dataset) {
                                                            dataset.data.push({
                                                                
                                                                x: Date.now(),
                                                                y: gyro_x                                      
                                                            });
                                                            });
                                                            
                                                        }      
                                                        }
  
                                                    }]
                                                    }
                                                    
                                                }
                                                });
                                        </script>
                                </div>
                            </div>


                        </div>
                        
                        <link href='http://fonts.googleapis.com/css?family=Titillium+Web:400,200,300,600,700' rel='stylesheet' type='text/css'>
                        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
                           
                </main>
                <footer class="py-4 bg-light mt-auto">
                    <div class="container-fluid">
                        <div class="d-flex align-items-center justify-content-between small">
                            <div class="text-muted">Copyright &copy; EduQube 2020 - Innova Space</div>
                            
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/chart-area-demo.js"></script>
        <script src="assets/demo/chart-bar-demo.js"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/datatables-demo.js"></script>
        <script src="assets/demo/chart-area-demo copy.js"></script>
        <script src="assets/demo/chart-area-demo copy 2.js"></script>
        <script src="assets/demo/chart-area-demo copy 3.js"></script>
    </body>
</html>
